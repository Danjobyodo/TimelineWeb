<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b57d0" />
  <title>Timeline Trace (Local)</title>

  <link rel="manifest" href="./manifest.webmanifest" />

  <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16.png" />
  <link rel="icon" href="./icon.svg" type="image/svg+xml" />

  <!-- Leaflet (CDN) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
    defer
  ></script>

  <style>
    :root{
      --bg:#0b0f19;
      --panel:#111827;
      --panel2:#0f172a;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --accent:#0b57d0;
      --danger:#f97316;
      --border:rgba(148,163,184,.25);
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: linear-gradient(180deg, #090a12 0%, #0b0f19 100%);
      color:var(--text);
      overflow:hidden;
    }
    a{color:inherit}
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 14px;
      border-bottom:1px solid var(--border);
      background: rgba(15,23,42,.9);
      backdrop-filter: blur(10px);
      position:sticky; top:0; z-index:10;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      min-width: 260px;
    }
    .brand svg{width:22px;height:22px}
    .brand-title{font-weight:700; letter-spacing:.2px}
    .brand-sub{font-size:12px;color:var(--muted); margin-top:1px}
    .controls{display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .btn{
      border:1px solid var(--border);
      background: rgba(17,24,39,.75);
      color:var(--text);
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer;
      display:inline-flex; align-items:center; gap:8px;
      transition: transform .05s ease, background .15s ease;
      user-select:none;
    }
    .btn:hover{background: rgba(30,41,59,.8)}
    .btn:active{transform: translateY(1px)}
    .btn[disabled]{opacity:.45; cursor:not-allowed}
    .btn.primary{background: rgba(11,87,208,.25); border-color: rgba(11,87,208,.6)}
    .btn.primary:hover{background: rgba(11,87,208,.35)}
    .file{
      position:relative; overflow:hidden;
    }
    .file input[type=file]{
      position:absolute; inset:0;
      opacity:0; cursor:pointer;
    }
    .layout{
      height: calc(100% - 54px);
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:0;
    }
    @media (max-width: 900px){
      body{overflow:auto}
      .layout{
        height:auto;
        grid-template-columns: 1fr;
        grid-template-rows: 55vh auto;
      }
    }
    .panel{
      border-right:1px solid var(--border);
      background: rgba(17,24,39,.85);
      backdrop-filter: blur(10px);
      overflow:auto;
    }
    @media (max-width: 900px){
      .panel{border-right:none; border-top:1px solid var(--border)}
    }
    .map{
      position:relative;
      background: #0b1022;
    }
    #map{
      position:absolute; inset:0;
    }
    .section{
      padding:12px 12px 6px;
      border-bottom:1px solid var(--border);
    }
    .section h2{
      margin:0 0 8px;
      font-size:13px;
      letter-spacing:.3px;
      text-transform:uppercase;
      color:var(--muted);
      font-weight:700;
    }
    .kvs{
      display:grid;
      grid-template-columns: 1fr;
      gap:6px;
      font-size:13px;
    }
    .kv{
      display:flex; justify-content:space-between; gap:8px;
      padding:8px 10px;
      border:1px solid var(--border);
      border-radius:12px;
      background: rgba(15,23,42,.65);
    }
    .kv b{font-weight:650}
    .kv span{color:var(--muted)}
    .warning{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      background: rgba(249,115,22,.12);
      border:1px solid rgba(249,115,22,.35);
      color: #fed7aa;
      font-size:12px;
      line-height:1.35;
    }
    .headerbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      padding:12px;
      border-bottom:1px solid var(--border);
      background: rgba(15,23,42,.75);
      position:sticky; top:0; z-index:5;
    }
    .day-title{
      display:flex; flex-direction:column; gap:2px;
      min-width: 160px;
    }
    .day-title .big{font-weight:800}
    .day-title .small{font-size:12px; color:var(--muted)}
    .header-actions{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:flex-end;
    }
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(17,24,39,.65);
      color: var(--muted);
    }
    .calendar{
      padding:12px;
      border-bottom:1px solid var(--border);
    }
    .cal-top{
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:10px;
    }
    .cal-top .month{font-weight:800}
    .cal-top .hint{font-size:12px;color:var(--muted)}
    .grid{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap:6px;
    }
    .dow{
      text-align:center;
      font-size:11px;
      color:var(--muted);
      padding:2px 0;
    }
    .cell{
      height:32px;
      border-radius:10px;
      border:1px solid transparent;
      background: rgba(15,23,42,.35);
      display:flex; align-items:center; justify-content:center;
      font-size:13px;
      user-select:none;
    }
    .cell.empty{background:transparent; border-color:transparent}
    .cell.avail{
      cursor:pointer;
      border-color: rgba(148,163,184,.22);
      background: rgba(148,163,184,.08);
    }
    .cell.avail:hover{background: rgba(148,163,184,.13)}
    .cell.selected{
      background: rgba(11,87,208,.35);
      border-color: rgba(11,87,208,.7);
      font-weight:800;
    }
    .cell.disabled{
      opacity:.25;
    }
    .list{
      padding:10px 10px 14px;
    }
    .row{
      display:grid;
      grid-template-columns: 56px 1fr;
      gap:10px;
      padding:10px 10px;
      border:1px solid var(--border);
      border-radius:14px;
      background: rgba(15,23,42,.45);
      margin-bottom:10px;
      box-shadow: none;
    }
    .time{
      font-family: var(--mono);
      font-size:11px;
      color: var(--muted);
      text-align:right;
      line-height:1.2;
      padding-top:2px;
    }
    .main{
      display:flex; flex-direction:column; gap:4px;
      min-width:0;
    }
    .title{
      display:flex; align-items:center; gap:8px;
      min-width:0;
    }
    .emoji{width:20px; text-align:center}
    .title b{
      font-weight:800;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .subtitle{
      color: var(--muted);
      font-size:12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .footer{
      padding:10px 12px 18px;
      color: var(--muted);
      font-size:12px;
      line-height:1.35;
      border-top:1px solid var(--border);
    }
    .toast{
      position: absolute;
      right: 12px;
      bottom: 12px;
      max-width: min(520px, calc(100% - 24px));
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(17,24,39,.88);
      box-shadow: var(--shadow);
      font-size: 12px;
      color: var(--text);
      display:none;
      z-index: 50;
    }
    .toast.show{display:block}
    .toast .small{color:var(--muted); margin-top:4px}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brand" aria-label="Timeline Trace">
      <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
        <path fill="currentColor" d="M12 2c3.9 0 7 3.1 7 7c0 5.3-7 13-7 13S5 14.3 5 9c0-3.9 3.1-7 7-7Zm0 9.5A2.5 2.5 0 1 0 12 6.5a2.5 2.5 0 0 0 0 5Z"/>
      </svg>
      <div>
        <div class="brand-title">Timeline Trace (Local)</div>
        <div class="brand-sub">JSON is processed locally in your browser</div>
      </div>
    </div>

    <div class="controls">
      <span class="pill" id="formatPill">No file</span>
      <label class="btn primary file" title="Google Maps Timeline JSON„ÇíÈÅ∏Êäû">
        <span>üìÑ JSON„ÇíÈÅ∏„Å∂</span>
        <input id="fileInput" type="file" accept=".json,application/json" />
      </label>
      <button class="btn" id="prevBtn" disabled title="Ââç„ÅÆÊúâÂäπÊó•„Å∏ (Alt + ‚Üê)">
        ‚óÄ Ââç
      </button>
      <button class="btn" id="nextBtn" disabled title="Ê¨°„ÅÆÊúâÂäπÊó•„Å∏ (Alt + ‚Üí)">
        Ê¨° ‚ñ∂
      </button>
    </div>
  </div>

  <div class="layout">
    <aside class="panel" id="panel">
      <div class="section">
        <h2>Summary</h2>
        <div class="kvs">
          <div class="kv"><b>Loaded items</b><span id="countItems">0</span></div>
          <div class="kv"><b>Available days</b><span id="countDays">0</span></div>
          <div class="kv"><b>Selected day</b><span id="selectedDayLabel">-</span></div>
        </div>

        <div class="warning">
          <b>Privacy note</b><br/>
          This app does not upload your JSON anywhere. It runs entirely in your browser.<br/>
          However, map tiles are fetched from a tile server (OpenStreetMap) to display the map background.
        </div>
      </div>

      <div class="headerbar">
        <div class="day-title">
          <div class="big" id="dayTitle">„Éá„Éº„Çø„Å™„Åó</div>
          <div class="small" id="daySub">JSON„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</div>
        </div>
        <div class="header-actions">
          <span class="pill" id="dayPill">-</span>
        </div>
      </div>

      <div class="calendar" id="calendar">
        <!-- calendar injected -->
      </div>

      <div class="list" id="list">
        <!-- list injected -->
      </div>

      <div class="footer">
        Tips: Alt + ‚Üê / ‚Üí „ÅßÂâçÂæå„ÅÆÊúâÂäπÊó•„Å´ÁßªÂãï„Åß„Åç„Åæ„Åô„ÄÇ<br/>
        GitHub Pages „ÅÆ„Çµ„Éñ„Éë„ÇπÈÖç‰ø°„Åß„ÇÇÂãï„Åè„Çà„ÅÜ„Å´„ÄÅÁõ∏ÂØæ„Éë„Çπ„ÅßPWAÁôªÈå≤„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
      </div>
    </aside>

    <main class="map">
      <div id="map"></div>
      <div class="toast" id="toast">
        <div id="toastMsg"></div>
        <div class="small" id="toastSmall"></div>
      </div>
    </main>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
